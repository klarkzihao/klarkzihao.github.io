<!DOCTYPE html>
<!-- saved from url=(0037)http://02f9az.coding-pages.com/task8/ -->
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>Tasks</title>
    <style>
        html {
            box-sizing: border-box;
        }
        
        *,
        *::before,
        *::after {
            box-sizing: inherit;
        }
        
        input,
        select,
        button {
            font: inherit;
        }
        
        .task-show {
            column-gap: 8px;
        }
        
        .item {
            display: inline-block;
            width: 100%;
        }
        
        h3 {
            margin: 0;
        }
        
        h3 img {
            width: 16px;
            vertical-align: middle;
        }
        
        iframe {
            display: block;
            height: 400px;
            width: 100%;
            border: 3px solid;
            border-radius: 10px;
        }
        
        .uploaded {
            background-color: #2ECC40;
        }
        
        .stat {
            display: inline-block;
            width: 20%;
            height: 400px;
            border: 2px solid;
            overflow: auto;
        }
        
        .stat ul {
            list-style: none;
            padding: 0;
            margin: 0;
            white-space: nowrap;
        }
        
        .stat ul a {
            color: blue;
            text-decoration: none;
        }
        
        .header {
            position: sticky;
            top: 0;
            background-color: white;
            box-shadow: 0 5px 5px #ccc;
            margin: 0 -8px;
            margin-bottom: 8px;
        }
    </style>
</head>

<body>
    <div id="app">
        <h2 class="header"><span>选择作业：</span> <select>
        <option value="">请选择</option>
        <option value="https://[username].github.io/miao/a.txt">https://[username].github.io/miao/a.txt</option>
        <option value="https://[username].github.io/miao/red-paragraph.html">
          https://[username].github.io/miao/red-paragraph.html</option>
        <option value="https://[username].github.io/miao/test1.txt">https://[username].github.io/miao/test1.txt</option>
        <option value="https://[username].github.io/miao/html-basic.html">
          https://[username].github.io/miao/html-basic.html</option>
        <option value="https://[username].github.io/miao/css-selector-practise.html">
          https://[username].github.io/miao/css-selector-practise.html</option>
        <option value="https://[username].github.io/miao/block-basic.html">
          https://[username].github.io/miao/block-basic.html</option>
        <option value="https://[username].github.io/miao/css-triangle.html">
          https://[username].github.io/miao/css-triangle.html</option>
        <option value="https://[username].github.io/miao/normal-flow-horizontal.html">
          https://[username].github.io/miao/normal-flow-horizontal.html</option>
        <option value="https://[username].github.io/miao/css-block-grid.html">
          https://[username].github.io/miao/css-block-grid.html</option>
        <option value="https://[username].github.io/miao/css-block-layout.html">
          https://[username].github.io/miao/css-block-layout.html</option>
        <option value="https://[username].github.io/miao/css-sprite.html">
          https://[username].github.io/miao/css-sprite.html</option>
        <option value="https://[username].github.io/miao/css-glassy.html">
          https://[username].github.io/miao/css-glassy.html</option>
        <option value="https://[username].github.io/miao/div-img-contain.html">
          https://[username].github.io/miao/div-img-contain.html</option>
        <option value="https://[username].github.io/miao/twitter-heart.html">
          https://[username].github.io/miao/twitter-heart.html</option>
        <option value="https://[username].github.io/miao/ios-checkbox.html">
          https://[username].github.io/miao/ios-checkbox.html</option>
        <option value="https://[username].github.io/miao/radio-slider.html">
          https://[username].github.io/miao/radio-slider.html</option>
        <option value="https://[username].github.io/miao/css-menu.html">https://[username].github.io/miao/css-menu.html
        </option>
        <option value="https://[username].github.io/miao/9-grid.html">https://[username].github.io/miao/9-grid.html
        </option>
        <option value="https://[username].github.io/miao/mobike.html">https://[username].github.io/miao/mobike.html
        </option>
        <option value="https://[username].github.io/miao/mi/index.html">https://[username].github.io/miao/mi/index.html
        </option>
        <option value="https://[username].github.io/miao/oald-layout.html">
          https://[username].github.io/miao/oald-layout.html</option>
        <option value="https://[username].github.io/miao/oald-layout-position.html">
          https://[username].github.io/miao/oald-layout-position.html</option>
        <option value="https://[username].github.io/miao/oald-layout-float.html">
          https://[username].github.io/miao/oald-layout-float.html</option>
        <option value="https://[username].github.io/miao/oald-layout-flex.html">
          https://[username].github.io/miao/oald-layout-flex.html</option>
        <option value="https://[username].github.io/miao/qq-mail.html">https://[username].github.io/miao/qq-mail.html
        </option>
        <option value="https://[username].github.io/miao/qq-mail-position.html">
          https://[username].github.io/miao/qq-mail-position.html</option>
        <option value="https://[username].github.io/miao/qq-mail-float.html">
          https://[username].github.io/miao/qq-mail-float.html</option>
        <option value="https://[username].github.io/miao/qq-mail-flex.html">
          https://[username].github.io/miao/qq-mail-flex.html</option>
        <option value="https://[username].github.io/miao/abs-center.html">
          https://[username].github.io/miao/abs-center.html</option>
        <option value="https://[username].github.io/miao/input-beauty.html">
          https://[username].github.io/miao/input-beauty.html</option>
        <option value="https://[username].github.io/miao/background-practise.html">
          https://[username].github.io/miao/background-practise.html</option>
        <option value="https://[username].github.io/miao/jiefangcheng.html">
          https://[username].github.io/miao/jiefangcheng.html</option>
        <option value="https://[username].github.io/miao/noi.html">https://[username].github.io/miao/noi.html</option>
        <option value="https://[username].github.io/miao/paint.html">https://[username].github.io/miao/paint.html
        </option>
        <option value="https://[username].github.io/miao/css-3d.html">https://[username].github.io/miao/css-3d.html
        </option>
        <option value="https://[username].github.io/miao/css-3d.html">https://[username].github.io/miao/css-3d.html
        </option>
        <option value="https://[username].github.io/miao/link-effect.html">
          https://[username].github.io/miao/link-effect.html</option>
        <option value="https://[username].github.io/miao/mobile.html">https://[username].github.io/miao/mobile.html
        </option>
        <option value="https://[username].github.io/miao/balloon-css.html">
          https://[username].github.io/miao/balloon-css.html</option>
        <option value="https://[username].github.io/miao/footer-at-bottom.html">
          https://[username].github.io/miao/footer-at-bottom.html</option>
        <option value="https://[username].github.io/miao/fullstory-footer.html">
          https://[username].github.io/miao/fullstory-footer.html</option>
        <option value="https://[username].github.io/miao/bootstrap-table.html">
          https://[username].github.io/miao/bootstrap-table.html</option>
        <option value="https://[username].github.io/miao/css-abs-center.html">
          https://[username].github.io/miao/css-abs-center.html</option>
        <option value="https://[username].github.io/miao/css-slider.html">
          https://[username].github.io/miao/css-slider.html</option>
        <option value="https://[username].github.io/miao/css-layout-02.html">
          https://[username].github.io/miao/css-layout-02.html</option>
        <option value="https://[username].github.io/miao/css-doraemon.html">
          https://[username].github.io/miao/css-doraemon.html</option>
        <option value="https://[username].github.io/miao/css-background.html">
          https://[username].github.io/miao/css-background.html</option>
        <option value="https://[username].github.io/miao/css-layout-1.html">
          https://[username].github.io/miao/css-layout-1.html</option>
        <option value="https://[username].github.io/miao/css-inline-layout.html">
          https://[username].github.io/miao/css-inline-layout.html</option>
        <option value="https://[username].github.io/miao/basic-coding.html">
          https://[username].github.io/miao/basic-coding.html</option>
      </select> 列数(4)：

            <input type="range" min="1" max="10"> 高度(400)：

            <input type="range" step="10" min="100" max="1000"> 模板：

            <select>
        <option value="">无</option>
        <option value="view-source.html#">查看源代码</option>
        <option value="basic-coding-test.html#">基本编程能力测试</option>
        <option value="oop-test.html#">面向对象练习</option>
        <option value="stat.html#">统计</option>
      </select> <button>切换统计</button></h2>
        <!---->
        <div class="task-show" style="column-count: 4;"></div>
    </div>

    <script src="./Tasks_files/vue.js"></script>
    <script>
        var usernames = [
            ['StarLightGX', '8418-夏A甫'],
            ['klarkzihao', '8421-孔Z豪'],
        ]

        var tasks = [
            `https://[username].github.io/miao/a.txt`,
            `https://[username].github.io/miao/red-paragraph.html`,
            `https://[username].github.io/miao/test1.txt`,
            `https://[username].github.io/miao/html-basic.html`,
            `https://[username].github.io/miao/css-selector-practise.html`,
            `https://[username].github.io/miao/block-basic.html`,
            `https://[username].github.io/miao/css-triangle.html`,
            `https://[username].github.io/miao/normal-flow-horizontal.html`,
            `https://[username].github.io/miao/css-block-grid.html`,
            `https://[username].github.io/miao/css-block-layout.html`,
            `https://[username].github.io/miao/css-sprite.html`,
            `https://[username].github.io/miao/css-glassy.html`,
            `https://[username].github.io/miao/div-img-contain.html`,
            `https://[username].github.io/miao/twitter-heart.html`,
            `https://[username].github.io/miao/ios-checkbox.html`,
            `https://[username].github.io/miao/radio-slider.html`,
            `https://[username].github.io/miao/css-menu.html`,
            `https://[username].github.io/miao/9-grid.html`,
            `https://[username].github.io/miao/mobike.html`,
            `https://[username].github.io/miao/mi/index.html`,
            `https://[username].github.io/miao/oald-layout.html`,
            `https://[username].github.io/miao/oald-layout-position.html`,
            `https://[username].github.io/miao/oald-layout-float.html`,
            `https://[username].github.io/miao/oald-layout-flex.html`,
            `https://[username].github.io/miao/qq-mail.html`,
            `https://[username].github.io/miao/qq-mail-position.html`,
            `https://[username].github.io/miao/qq-mail-float.html`,
            `https://[username].github.io/miao/qq-mail-flex.html`,
            `https://[username].github.io/miao/abs-center.html`,
            `https://[username].github.io/miao/input-beauty.html`,
            `https://[username].github.io/miao/background-practise.html`,
            `https://[username].github.io/miao/jiefangcheng.html`,
            `https://[username].github.io/miao/noi.html`,
            `https://[username].github.io/miao/paint.html`,
            `https://[username].github.io/miao/css-3d.html`,
            `https://[username].github.io/miao/css-3d.html`,
            `https://[username].github.io/miao/link-effect.html`,
            `https://[username].github.io/miao/mobile.html`,
            `https://[username].github.io/miao/balloon-css.html`,
            `https://[username].github.io/miao/footer-at-bottom.html`,
            `https://[username].github.io/miao/fullstory-footer.html`,
            `https://[username].github.io/miao/bootstrap-table.html`,
            `https://[username].github.io/miao/css-abs-center.html`,
            `https://[username].github.io/miao/css-slider.html`,
            `https://[username].github.io/miao/css-layout-02.html`,
            `https://[username].github.io/miao/css-doraemon.html`,
            `https://[username].github.io/miao/css-background.html`,
            `https://[username].github.io/miao/css-layout-1.html`,
            `https://[username].github.io/miao/css-inline-layout.html`,
            `https://[username].github.io/miao/basic-coding.html`,
            // `https://[username].github.io/miao/a.html`,
            // `https://[username].github.io/miao/oop.js`,
            // `http://[username].coding.me/task/css-practise01.html`,
            // `http://[username].coding.me/task/css-link-effect.html`,
            // `https://[username].coding.me/task/openjudge.html`,
        ]
    </script>
    <script>
        Vue.component('stat', {
            props: ['user'],
            template: `
      <div class="stat" :style="{order: uploadedCount}">
        <h3>{{user[1]}}: <a target="_blank" :href="'https://github.com/' + user[0] + '/miao'">{{uploadedCount}}</a> <button @click="refresh">刷新</button></h3>
        <ul>
          <li v-for="(task,index) of tasks" :class="taskStats[index] ? 'uploaded' : 'unloaded'">
            <a :href="task">{{getTaskName(task)}}</a>
          </li>
        </ul>
      </div>
    `,
            data() {
                var tasks = window.tasks
                return {
                    tasks: tasks.map(it => it.replace('[username]', this.user[0])),
                    taskStats: [],
                    uploadedCount: 0,
                    tried: 0,
                }
            },
            methods: {
                refresh() {
                    this.getStat()
                },
                getTaskName(url) {
                    var pos = url.indexOf('miao')
                    return url.slice(pos + 5)
                },
                async getStat() {
                    this.tried++
                        this.taskStats = await Promise.all(this.tasks.map(isTaskUploaded))
                    this.uploadedCount = this.taskStats.filter(it => it).length

                    if (this.uploadedCount === 0 && this.tried < 5) {
                        this.getStat()
                    }

                    function isTaskUploaded(url) {
                        return new Promise((resolve, reject) => {
                            fetch(url, {
                                method: 'HEAD'
                            }).then(res => {
                                if (res.status === 200) {
                                    resolve(true)
                                } else {
                                    resolve(false)
                                }
                            }).catch(err => {
                                resolve(false)
                            })
                        })
                    }
                }
            },
            mounted() {
                this.getStat()
            }
        })

        Vue.component('task-show', {
            props: ['user', 'url', 'index', 'height'],
            template: `
      <div class="item">
        <h3>
          {{index + 1}}.<a target="_blank" :href="url">{{user[0]}}({{user[1].slice(5)}})</a> |
          <a :href="'https://github.com/' + user[0]" target="_blank">Github</a>
          <button @click="refresh">刷新</button>
        </h3>
        <iframe ref="iframe" :style="{height:height+'px'}" :src="url" frameborder="1"></iframe>
      </div>
    `,
            methods: {
                refresh(e) {
                    this.$refs.iframe.src = ''
                    setTimeout(() => {
                        this.$refs.iframe.src = this.url
                    }, 50)
                }
            }
        })

        var app = new Vue({
            el: '#app',
            data: {
                showStat: false,
                usernames: usernames,
                tasks: tasks,
                selectedTask: '',
                columnCount: 4,
                height: 400,
                showSource: true,
                viewTemplate: 'view-source.html#'
            },
            computed: {
                taskUrls() {
                    if (this.selectedTask == '') {
                        return []
                    } else {
                        return this.usernames.map(([name]) => {
                            return this.viewTemplate + this.selectedTask.replace('[username]', name)
                        })
                    }
                }
            }
        })
    </script>


</body>

</html>